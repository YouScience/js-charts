!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.JSCharts=e(t.d3)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,e,n){var i=void 0;return function(){var r=this,l=arguments,o=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(r,l)},e),o&&t.apply(r,l)}},n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,l=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,l=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw l}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;e.length>n;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=e;return{DonutBuilder:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t.target,this.fontSize=t.fontSize||38,this.lineHeight=t.lineHeight||20,this.colors=t.colors||null,this.fontColor=t.fontColor||"#000000",this.backgroundColor=t.backgroundColor||"#FFFFFF",this.width=t.size||300,this.height=t.size||300,this.highlightOnHover=t.highlightOnHover||!1,this.hoverStrokeWidth=t.hoverStrokeWidth||6,this.selectevent=t.selectevent||"mouseenter",this.selectblurevent=t.selectblurevent||"mouseleave",this.onselect=t.onselect||function(){},this.onselectblur=t.onselectblur||function(){},this.title=t.title,this.labels=t.labels,this.outerRadiusRatio=t.outerRadiusRatio||3,this.innerRadiusRatio=t.innerRadiusRatio||2.5,this.strokeColor=t.strokeColor||"#FFFFFF",this.strokeWidth=t.strokeWidth||2,this.initialStrokeWidth=t.initialStrokeWidth||10,this.activeShadow=t.activeShadow||!1,this.padAngle=t.padAngle||.08}return i(e,[{key:"onMouseEnterHandler",value:function(t){this.unhighlightInactiveSlices(),this.highlightSlice(t,this.hoverStrokeWidth,!1)}},{key:"onSelectHandler",value:function(t,e,n){this.selectSlice(n),this.unhighlightSlices(),this.highlightSlice(t,this.initialStrokeWidth),this.onselect.call(this.svg,this.findActiveSlice())}},{key:"onSelectBlurHandler",value:function(t,e,n){this.unhighlightInactiveSlices(),this.onselectblur.call(this.svg,this.findSlice(n))}},{key:"fontPx",value:function(t){if("number"!=typeof t)throw Error("Invalid fontSize value");return t+"px"}},{key:"midAngle",value:function(t){return t.startAngle+(t.endAngle-t.startAngle)/2}},{key:"selectSlice",value:function(t){this.slicestore.forEach(function(e){e.selected=e.index===t})}},{key:"findSlice",value:function(t){var e=null;return this.slicestore.forEach(function(n){n.index===t&&(e=n)}),e}},{key:"findActiveSlice",value:function(){var t=null;return this.slicestore.forEach(function(e){e.selected&&(t=e)}),t}},{key:"getColors",value:function(t){return t.map(function(t){return t.color})}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this;e=e.sort(function(t,e){return e.percent>t.percent});var l=i.colors?i.colors:i.getColors(e),o=t.layout.pie().value(function(t){return t.percent}).sort(null),a=i.width/i.outerRadiusRatio,s=i.width/i.innerRadiusRatio,c=l?t.scale.ordinal().range(l):t.scale.category20(),u=t.svg.arc().outerRadius(a).innerRadius(s).padAngle(i.padAngle),h=t.select(i.target).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",-i.width/2+" "+-i.height/2+" "+i.width+" "+i.height).attr("preserveAspectRatio","xMinYMin").attr({class:"jsc-svg-container jsc-donut",style:"background-color: "+i.backgroundColor}).append("g"),d=h.selectAll("path").data(o(e)).enter().append("path").attr({d:u,fill:function(t,e){return c(t.data.name)}}),f=h.selectAll(".legend").data(c.domain()).enter();i.title?f.append("text").attr("text-anchor","middle").attr("y",-1*i.lineHeight+30).attr("class",function(t,e){return"jsc-text jsc-text--title jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t){return i.title}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}):(f.append("text").attr("text-anchor","middle").attr("y",-1*i.lineHeight+10).attr("class",function(t,e){return"jsc-text jsc-text--name jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t){return t}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}),f.append("text").attr("text-anchor","middle").attr("y",i.lineHeight+10).attr("class",function(t,e){return"jsc-text jsc-text--percent jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t,e){}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}));var v=[];if(i.slicestore=v,i.svg=h,d.attr("class",function(t,n){return v.push({index:n,selected:0==n,data:e[n],fill:c(n)}),"u-clickable jsc-slice jsc-slice--"+n}).attr("stroke",function(t,e){return this.getAttribute("fill")}).attr("stroke-width",function(t,e){return 0==e?i.initialStrokeWidth:i.strokeWidth}).on("mouseenter",r(function(){i.highlightOnHover&&i.onMouseEnterHandler.call(i,this)},100)).on(i.selectevent,r(function(){i.onSelectHandler.apply(i,[this].concat(Array.prototype.slice.call(arguments)))},100)).on(i.selectblurevent,r(function(){i.onSelectBlurHandler.apply(i,[this].concat(Array.prototype.slice.call(arguments)))},100)),i.labels){var g=h.append("svg:g").attr("class","labels").selectAll("text").data(o(e),function(t){return t.data.name});g.enter().append("text").attr("class",function(t,e){return"jsc-label jsc-label--"+e}).attr("dy",".35em").text(function(t){return t.data.name}).on(i.selectevent,r(function(t,e){var r=h.select(".jsc-slice--"+e),l=n(r,1),o=n(l[0],1);i.onSelectHandler.call(i,o[0],t,e)},100)).on(i.selectblurevent,r(function(t,e){var r=h.select(".jsc-slice--"+e),l=n(r,1),o=n(l[0],1);i.onSelectBlurHandler.call(i,o[0],t,e)},100)),g.attr("transform",function(t){var e=u.centroid(t);return e[0]=s*(i.midAngle(t)<Math.PI?1:-1),"translate("+e+")"}).attr("text-anchor",function(t){return i.midAngle(t)<Math.PI?"start":"end"});var p=h.append("g").attr("class","lines").selectAll("polyline").data(o(e),function(t){return t.data.name});p.enter().append("polyline"),p.attr("points",function(t){var e=u.centroid(t);return e[0]=.95*s*(i.midAngle(t)<Math.PI?1:-1),[u.centroid(t),u.centroid(t),e]}).attr("class",function(t,e){return"jsc-label-line jsc-label-line--"+e}).attr("stroke-width","1").attr("fill","none").attr("stroke",function(t,e){return c(e)})}return{svg:function(){return h},data:function(){return e},slices:function(){return v}}}},{key:"slices",value:function(){return this.svg.selectAll(".jsc-slice")}},{key:"inactiveSlices",value:function(){return this.inactive(this.slices())}},{key:"unhighlightSlices",value:function(){this.unhighligh(this.slices())}},{key:"unhighlightInactiveSlices",value:function(){this.unhighligh(this.inactiveSlices())}},{key:"highlightSlice",value:function(e,n){var i=2>=arguments.length||void 0===arguments[2]||arguments[2],r=t.select(e);i||(r=this.inactive(r)),this.highlight(r,n,this.strokeColor)}},{key:"highlight",value:function(t,e,n){t.attr("stroke-width",e)}},{key:"unhighligh",value:function(t){t.attr("stroke-width",this.strokeWidth)}},{key:"inactive",value:function(t){var e=this.findActiveSlice();return t.filter(function(t){return t.data.name!==e.data.name})}}]),e}()}});
