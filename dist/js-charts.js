!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.JSCharts=e(t.d3)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,e,n){var i=void 0;return function(){var r=this,l=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(r,l)},e),a&&t.apply(r,l)}},n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,l=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,l=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;e.length>n;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=e,l={NONE:"none",INCREASE_SIZE:"increase_size",ADD_BORDER:"add_border"},a={background:"lightsteelblue",border:"0px","border-radius":"0.75em",display:"inline-block",padding:"0.5em","pointer-events":"none",position:"absolute","text-align":"center","z-index":2};return{DonutBuilder:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t.target,this.fontSize=t.fontSize||38,this.lineHeight=t.lineHeight||20,this.colors=t.colors||null,this.fontColor=t.fontColor||"#000000",this.backgroundColor=t.backgroundColor||"#FFFFFF",this.width=t.size||300,this.height=t.size||300,this.title=t.title,this.labels=t.labels,this.tooltips=t.tooltips,this.outerRadiusRatio=t.outerRadiusRatio||2.5,this.innerRadiusRatio=t.innerRadiusRatio||4,this.activeShadow=t.activeShadow||!1,this.padAngle=t.padAngle||.01,this.tooltipStyle=t.tooltipStyle||null,this.onHoverEffect=t.onHoverEffect||l.NONE,this.onSelectEffect=t.onSelectEffect||l.INCREASE_SIZE,this.borderOpacity=t.borderOpacity||.4,this.increaseRadiusStep=t.increaseRadiusStep||7,this.selectevent=t.selectevent||"mouseenter",this.selectblurevent=t.selectblurevent||"mouseleave",this.onselect=t.onselect||function(){},this.onselectblur=t.onselectblur||function(){}}return i(e,[{key:"onMouseEnterHandler",value:function(t){this.unhighlightInactiveSlices(),this.highlightSlice(t,this.onHoverEffect)}},{key:"onSelectHandler",value:function(t,e,n){this.selectSlice(t,n),this.onselect.call(this.svg,this.findActiveSlice())}},{key:"onSelectBlurHandler",value:function(t,e,n){this.unhighlightInactiveSlices(),this.onselectblur.call(this.svg,this.findSlice(n))}},{key:"selectSliceByName",value:function(e){var n=this.findSliceByName(e);if(n){var i=t.select(".jsc-slice--"+n.index);this.selectSlice(i.node(),n.index)}}},{key:"selectSlice",value:function(t,e){this.markSliceAsSelected(e),this.unhighlightSlices(),this.highlightSlice(t,this.onSelectEffect)}},{key:"fontPx",value:function(t){if("number"!=typeof t)throw Error("Invalid fontSize value");return t+"px"}},{key:"midAngle",value:function(t){return t.startAngle+(t.endAngle-t.startAngle)/2}},{key:"markSliceAsSelected",value:function(t){this.slicestore.forEach(function(e){e.selected=e.index===t})}},{key:"findSlice",value:function(t){var e=null;return this.slicestore.forEach(function(n){n.index===t&&(e=n)}),e}},{key:"findSliceByName",value:function(t){var e=null;return this.slicestore.forEach(function(n){n.data.name===t&&(e=n)}),e}},{key:"findActiveSlice",value:function(){var t=null;return this.slicestore.forEach(function(e){e.selected&&(t=e)}),t}},{key:"getColors",value:function(t){return t.map(function(t){return t.color})}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this;e=e.sort(function(t,e){return e.percent>t.percent});var s=i.colors?i.colors:i.getColors(e),o=t.layout.pie().value(function(t){return t.percent}).sort(null);i.outerRadius=i.width/i.outerRadiusRatio,i.innerRadius=i.width/i.innerRadiusRatio;var c=s?t.scale.ordinal().range(s):t.scale.category20(),u=t.svg.arc().outerRadius(i.outerRadius).innerRadius(i.innerRadius).padAngle(i.padAngle),d=t.select(i.target).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",-i.width/2+" "+-i.height/2+" "+i.width+" "+i.height).attr("preserveAspectRatio","xMinYMin").attr({class:"jsc-svg-container jsc-donut",style:"background-color: "+i.backgroundColor}).append("g"),h=d.selectAll("path").data(o(e)).enter().append("path").attr({d:u,fill:function(t,e){return c(t.data.name)}});if(this.onHoverEffect===l.ADD_BORDER||this.onSelectEffect===l.ADD_BORDER){var f=t.svg.arc().outerRadius(i.outerRadius+this.increaseRadiusStep).innerRadius(i.outerRadius+1).padAngle(i.padAngle);d.selectAll("path.outer-arc").data(o(e)).enter().append("path").attr({class:"outer-arc",d:f,fill:function(t,e){return c(t.data.name)},opacity:0}).attr("class",function(t,e){return"u-clickable jsc-slice-border jsc-slice--"+e})}var v=d.selectAll(".legend").data(c.domain()).enter();i.title?v.append("text").attr("text-anchor","middle").attr("y",-1*i.lineHeight+30).attr("class",function(t,e){return"jsc-text jsc-text--title jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t){return i.title}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}):(v.append("text").attr("text-anchor","middle").attr("y",-1*i.lineHeight+10).attr("class",function(t,e){return"jsc-text jsc-text--name jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t){return t}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}),v.append("text").attr("text-anchor","middle").attr("y",i.lineHeight+10).attr("class",function(t,e){return"jsc-text jsc-text--percent jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t,e){}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}));var p=[];if(i.slicestore=p,i.svg=d,h.attr("class",function(t,n){return p.push({index:n,selected:0==n,data:e[n],fill:c(n)}),"u-clickable jsc-slice jsc-slice--"+n}).on("mouseenter",r(function(){i.onMouseEnterHandler.call(i,this)},100)).on(i.selectevent,r(function(){i.onSelectHandler.apply(i,[this].concat(Array.prototype.slice.call(arguments)))},100)).on(i.selectblurevent,r(function(){i.onSelectBlurHandler.apply(i,[this].concat(Array.prototype.slice.call(arguments)))},100)),i.tooltips){var g=t.select(i.target).append("div");i.tooltipStyle?g.attr("class",i.tooltipStyle):g.style(a),h.on("mouseover",function(e){g.transition().duration(200).style("opacity",1),g.html(e.data.contentTooltip).style("left",t.event.pageX+"px").style("top",t.event.pageY-30+"px")}).on("mouseout",function(t){g.transition().duration(500).style("opacity",0)})}if(i.labels){var y=d.append("svg:g").attr("class","labels").selectAll("text").data(o(e),function(t){return t.data.name});y.enter().append("text").attr("class",function(t,e){return"jsc-label jsc-label--"+e}).attr("dy",".35em").text(function(t){return t.data.name}).on(i.selectevent,r(function(t,e){var r=d.select(".jsc-slice--"+e),l=n(r,1),a=n(l[0],1);i.onSelectHandler.call(i,a[0],t,e)},100)).on(i.selectblurevent,r(function(t,e){var r=d.select(".jsc-slice--"+e),l=n(r,1),a=n(l[0],1);i.onSelectBlurHandler.call(i,a[0],t,e)},100)),y.attr("transform",function(t){var e=u.centroid(t);return e[0]=innerRadius*(i.midAngle(t)<Math.PI?1:-1),"translate("+e+")"}).attr("text-anchor",function(t){return i.midAngle(t)<Math.PI?"start":"end"});var S=d.append("g").attr("class","lines").selectAll("polyline").data(o(e),function(t){return t.data.name});S.enter().append("polyline"),S.attr("points",function(t){var e=u.centroid(t);return e[0]=.95*innerRadius*(i.midAngle(t)<Math.PI?1:-1),[u.centroid(t),u.centroid(t),e]}).attr("class",function(t,e){return"jsc-label-line jsc-label-line--"+e}).attr("stroke-width","1").attr("fill","none").attr("stroke",function(t,e){return c(e)})}return{svg:function(){return d},data:function(){return e},slices:function(){return p}}}},{key:"slices",value:function(){return this.svg.selectAll(".jsc-slice")}},{key:"borderSlices",value:function(){return this.svg.selectAll(".jsc-slice-border")}},{key:"inactiveSlices",value:function(){return this.inactive(this.slices())}},{key:"inactiveBorderSlices",value:function(){return this.inactive(this.borderSlices())}},{key:"unhighlightSlices",value:function(){this.unhighligh(this.slices()),this.borderSlices().attr("opacity",0)}},{key:"unhighlightInactiveSlices",value:function(){this.unhighligh(this.inactiveSlices()),this.inactiveBorderSlices().attr("opacity",0)}},{key:"highlightSlice",value:function(t,e){switch(e){case l.ADD_BORDER:this.addBorderToSlice(t);break;case l.INCREASE_SIZE:this.increaseSliceSize(t)}}},{key:"addBorderToSlice",value:function(e){var n=t.select(e).attr("class");t.select(this.borderClassSelector(n)).attr("opacity",this.borderOpacity)}},{key:"increaseSliceSize",value:function(e){var n=t.svg.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius+this.increaseRadiusStep).padAngle(this.padAngle);t.select(e).transition().attr("d",n)}},{key:"unhighligh",value:function(e){var n=t.svg.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius).padAngle(this.padAngle);e.transition().attr("d",n)}},{key:"inactive",value:function(t){var e=this.findActiveSlice();return t.filter(function(t){return t.data.name!==e.data.name})}},{key:"borderClassSelector",value:function(t){var e=t.replace("jsc-slice","jsc-slice-border");return"."+(e=e.replace(/ /g,"."))}}]),e}()}});
