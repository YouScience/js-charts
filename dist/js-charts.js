!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.JSCharts=e(t.d3)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,e,n){var i=void 0;return function(){var r=this,l=arguments,o=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(r,l)},e),o&&t.apply(r,l)}},n=function(){function t(t,e){for(var n=0;e.length>n;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var i=e;return{DonutBuilder:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t.target,this.fontSize=t.fontSize||38,this.lineHeight=t.lineHeight||20,this.colors=t.colors||null,this.fontColor=t.fontColor||"#000000",this.backgroundColor=t.backgroundColor||"#FFFFFF",this.width=t.size||300,this.height=t.size||300,this.selectevent=t.selectevent||"mouseenter",this.selectblurevent=t.selectblurevent||"mouseleave",this.onselect=t.onselect||function(){},this.onselectblur=t.onselectblur||function(){},this.title=t.title,this.labels=t.labels,this.outerRadiusRatio=t.outerRadiusRatio||3,this.innerRadiusRatio=t.innerRadiusRatio||2.3,this.strokeColor=t.strokeColor||"#FFFFFF",this.strokeWidth=t.strokeWidth||5,this.initialStrokeWidth=t.initialStrokeWidth||4,this.activeShadow=t.activeShadow||!1}return n(e,[{key:"selecthandler",value:function(e,n,i,r,l){this.parentNode.insertBefore(this,this.parentNode.firstChild),i.selectAll(".jsc-slice").attr("stroke-width",e.strokeWidth).attr("stroke",e.strokeColor),t.select(this).attr("stroke-width",e.initialStrokeWidth).attr("stroke",function(){return this.getAttribute("fill")}),e.title||(i.selectAll(".jsc-text").attr("visibility","hidden"),i.selectAll(".jsc-text--"+l).attr("visibility","visible")),e.selectSlice(n,l),e.onselect.call(i,e.findSlice(n,l))}},{key:"selectblurhandler",value:function(t,e,n,i,r){t.onselectblur.call(n,t.findSlice(e,r))}},{key:"fontPx",value:function(t){if("number"!=typeof t)throw Error("Invalid fontSize value");return t+"px"}},{key:"midAngle",value:function(t){return t.startAngle+(t.endAngle-t.startAngle)/2}},{key:"selectSlice",value:function(t,e){t.forEach(function(t,n){t.selected=t.index===e})}},{key:"findSlice",value:function(t,e){var n=null;return t.forEach(function(t,i){t.index===e&&(n=t)}),n}},{key:"getColors",value:function(t){return t.map(function(t){return t.color})}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this;e=e.sort(function(t,e){return e.percent>t.percent});var r=n.colors?n.colors:n.getColors(e),l=t.layout.pie().value(function(t){return t.percent}).sort(null),o=n.width/n.outerRadiusRatio,a=n.width/n.innerRadiusRatio,s=r?t.scale.ordinal().range(r):t.scale.category20(),c=t.svg.arc().outerRadius(o).innerRadius(a),u=t.select(n.target).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",-n.width/2+" "+-n.height/2+" "+n.width+" "+n.height).attr("preserveAspectRatio","xMinYMin").attr({class:"jsc-svg-container jsc-donut",style:"background-color: "+n.backgroundColor}).append("g"),d=u.selectAll("path").data(l(e)).enter().append("path").attr({d:c,fill:function(t,e){return s(t.data.name)}}),f=u.selectAll(".legend").data(s.domain()).enter();n.title?f.append("text").attr("text-anchor","middle").attr("y",-1*n.lineHeight+30).attr("class",function(t,e){return"jsc-text jsc-text--title jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t){return n.title}).style({fill:n.fontColor,"font-size":n.fontPx(n.fontSize)}):(f.append("text").attr("text-anchor","middle").attr("y",-1*n.lineHeight+10).attr("class",function(t,e){return"jsc-text jsc-text--name jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t){return t}).style({fill:n.fontColor,"font-size":n.fontPx(n.fontSize)}),f.append("text").attr("text-anchor","middle").attr("y",n.lineHeight+10).attr("class",function(t,e){return"jsc-text jsc-text--percent jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t,e){}).style({fill:n.fontColor,"font-size":n.fontPx(n.fontSize)}));var h=[],p={};if(d.attr("fill",function(t,e){var n=s(e);return p[e]=n,n}).attr("class",function(t,n){return h.push({index:n,selected:0==n,data:e[n],fill:p[n]}),"jsc-slice jsc-slice--"+n}).attr("stroke",function(t,e){return 0==e?this.getAttribute("fill"):n.strokeColor}).attr("stroke-width",function(t,e){return 0==e?n.initialStrokeWidth:n.strokeWidth}).on(n.selectevent,i(function(){n.selecthandler.apply(this,[n,h,u].concat(Array.prototype.slice.call(arguments)))},100)).on(n.selectblurevent,i(function(){n.selectblurhandler.apply(this,[n,h,u].concat(Array.prototype.slice.call(arguments)))},100)),n.labels){var v=u.append("svg:g").attr("class","labels").selectAll("text").data(l(e),function(t){return t.data.name});v.enter().append("text").attr("class",function(t,e){return"jsc-label jsc-label--"+e}).attr("dy",".35em").text(function(t){return t.data.name}).on(n.selectevent,i(function(t,e){var i=u.select(".jsc-slice--"+e);n.selecthandler.call(i[0][0],n,h,t,e,u)},100)).on(n.selectblurevent,i(function(t,e){var i=u.select(".jsc-slice--"+e);n.selectblurhandler.call(i[0][0],n,h,t,e,u)},100)),v.attr("transform",function(t){var e=c.centroid(t);return e[0]=a*(n.midAngle(t)<Math.PI?1:-1),"translate("+e+")"}).attr("text-anchor",function(t){return n.midAngle(t)<Math.PI?"start":"end"});var g=u.append("g").attr("class","lines").selectAll("polyline").data(l(e),function(t){return t.data.name});g.enter().append("polyline"),g.attr("points",function(t){var e=c.centroid(t);return e[0]=.95*a*(n.midAngle(t)<Math.PI?1:-1),[c.centroid(t),c.centroid(t),e]}).attr("class",function(t,e){return"jsc-label-line jsc-label-line--"+e}).attr("stroke-width","1").attr("fill","none").attr("stroke",function(t,e){return s(e)})}return{svg:function(){return u},data:function(){return e},slices:function(){return h}}}}]),e}()}});
