!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):e.JSCharts=t(e.d3)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=function(e,t,n){var i=void 0;return function(){var r=this,a=arguments,l=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(r,a)},t),l&&e.apply(r,a)}},n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var l,c=e[Symbol.iterator]();!(i=(l=c.next()).done)&&(n.push(l.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(r)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;t.length>n;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=t,a={NONE:"none",INCREASE_SIZE:"increase_size",ADD_BORDER:"add_border"};return{DonutBuilder:function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.target=e.target,this.fontSize=e.fontSize||38,this.lineHeight=e.lineHeight||20,this.colors=e.colors||null,this.fontColor=e.fontColor||"#000000",this.backgroundColor=e.backgroundColor||"#FFFFFF",this.width=e.size||300,this.height=e.size||300,this.title=e.title,this.labels=e.labels,this.outerRadiusRatio=e.outerRadiusRatio||2.5,this.innerRadiusRatio=e.innerRadiusRatio||4,this.activeShadow=e.activeShadow||!1,this.padAngle=e.padAngle||.01,this.onHoverEffect=e.onHoverEffect||a.NONE,this.onSelectEffect=e.onSelectEffect||a.INCREASE_SIZE,this.borderOpacity=e.borderOpacity||.4,this.increaseRadiusStep=e.increaseRadiusStep||7,this.selectevent=e.selectevent||"mouseenter",this.selectblurevent=e.selectblurevent||"mouseleave",this.onselect=e.onselect||function(){},this.onselectblur=e.onselectblur||function(){}}return i(t,[{key:"onMouseEnterHandler",value:function(e){this.unhighlightInactiveSlices(),this.highlightSlice(e,this.onHoverEffect)}},{key:"onSelectHandler",value:function(e,t,n){this.selectSlice(e,n),this.onselect.call(this.svg,this.findActiveSlice())}},{key:"onSelectBlurHandler",value:function(e,t,n){this.unhighlightInactiveSlices(),this.onselectblur.call(this.svg,this.findSlice(n))}},{key:"selectSliceByName",value:function(t){var n=this.findSliceByName(t);if(n){var i=e.select(".jsc-slice--"+n.index);this.selectSlice(i.node(),n.index)}}},{key:"selectSlice",value:function(e,t){this.markSliceAsSelected(t),this.unhighlightSlices(),this.highlightSlice(e,this.onSelectEffect)}},{key:"fontPx",value:function(e){if("number"!=typeof e)throw Error("Invalid fontSize value");return e+"px"}},{key:"midAngle",value:function(e){return e.startAngle+(e.endAngle-e.startAngle)/2}},{key:"markSliceAsSelected",value:function(e){this.slicestore.forEach(function(t){t.selected=t.index===e})}},{key:"findSlice",value:function(e){var t=null;return this.slicestore.forEach(function(n){n.index===e&&(t=n)}),t}},{key:"findSliceByName",value:function(e){var t=null;return this.slicestore.forEach(function(n){n.data.name===e&&(t=n)}),t}},{key:"findActiveSlice",value:function(){var e=null;return this.slicestore.forEach(function(t){t.selected&&(e=t)}),e}},{key:"getColors",value:function(e){return e.map(function(e){return e.color})}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this;t=t.sort(function(e,t){return t.percent>e.percent});var l=i.colors?i.colors:i.getColors(t),c=e.layout.pie().value(function(e){return e.percent}).sort(null);i.outerRadius=i.width/i.outerRadiusRatio,i.innerRadius=i.width/i.innerRadiusRatio;var s=l?e.scale.ordinal().range(l):e.scale.category20(),o=e.svg.arc().outerRadius(i.outerRadius).innerRadius(i.innerRadius).padAngle(i.padAngle),u=e.select(i.target).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",-i.width/2+" "+-i.height/2+" "+i.width+" "+i.height).attr("preserveAspectRatio","xMinYMin").attr({class:"jsc-svg-container jsc-donut",style:"background-color: "+i.backgroundColor}).append("g"),d=u.selectAll("path").data(c(t)).enter().append("path").attr({d:o,fill:function(e,t){return s(e.data.name)}});if(this.onHoverEffect===a.ADD_BORDER||this.onSelectEffect===a.ADD_BORDER){var h=e.svg.arc().outerRadius(i.outerRadius+this.increaseRadiusStep).innerRadius(i.outerRadius+1).padAngle(i.padAngle);u.selectAll("path.outer-arc").data(c(t)).enter().append("path").attr({class:"outer-arc",d:h,fill:function(e,t){return s(e.data.name)},opacity:0}).attr("class",function(e,t){return"u-clickable jsc-slice-border jsc-slice--"+t})}var f=u.selectAll(".legend").data(s.domain()).enter();i.title?f.append("text").attr("text-anchor","middle").attr("y",-1*i.lineHeight+30).attr("class",function(e,t){return"jsc-text jsc-text--title jsc-text--"+t}).attr("visibility",function(e,t){return 0==t?"visible":"hidden"}).text(function(e){return i.title}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}):(f.append("text").attr("text-anchor","middle").attr("y",-1*i.lineHeight+10).attr("class",function(e,t){return"jsc-text jsc-text--name jsc-text--"+t}).attr("visibility",function(e,t){return 0==t?"visible":"hidden"}).text(function(e){return e}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}),f.append("text").attr("text-anchor","middle").attr("y",i.lineHeight+10).attr("class",function(e,t){return"jsc-text jsc-text--percent jsc-text--"+t}).attr("visibility",function(e,t){return 0==t?"visible":"hidden"}).text(function(e,t){}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}));var v=[];if(i.slicestore=v,i.svg=u,d.attr("class",function(e,n){return v.push({index:n,selected:0==n,data:t[n],fill:s(n)}),"u-clickable jsc-slice jsc-slice--"+n}).on("mouseenter",r(function(){i.onMouseEnterHandler.call(i,this)},100)).on(i.selectevent,r(function(){i.onSelectHandler.apply(i,[this].concat(Array.prototype.slice.call(arguments)))},100)).on(i.selectblurevent,r(function(){i.onSelectBlurHandler.apply(i,[this].concat(Array.prototype.slice.call(arguments)))},100)),i.labels){var p=u.append("svg:g").attr("class","labels").selectAll("text").data(c(t),function(e){return e.data.name});p.enter().append("text").attr("class",function(e,t){return"jsc-label jsc-label--"+t}).attr("dy",".35em").text(function(e){return e.data.name}).on(i.selectevent,r(function(e,t){var r=u.select(".jsc-slice--"+t),a=n(r,1),l=n(a[0],1);i.onSelectHandler.call(i,l[0],e,t)},100)).on(i.selectblurevent,r(function(e,t){var r=u.select(".jsc-slice--"+t),a=n(r,1),l=n(a[0],1);i.onSelectBlurHandler.call(i,l[0],e,t)},100)),p.attr("transform",function(e){var t=o.centroid(e);return t[0]=innerRadius*(i.midAngle(e)<Math.PI?1:-1),"translate("+t+")"}).attr("text-anchor",function(e){return i.midAngle(e)<Math.PI?"start":"end"});var g=u.append("g").attr("class","lines").selectAll("polyline").data(c(t),function(e){return e.data.name});g.enter().append("polyline"),g.attr("points",function(e){var t=o.centroid(e);return t[0]=.95*innerRadius*(i.midAngle(e)<Math.PI?1:-1),[o.centroid(e),o.centroid(e),t]}).attr("class",function(e,t){return"jsc-label-line jsc-label-line--"+t}).attr("stroke-width","1").attr("fill","none").attr("stroke",function(e,t){return s(t)})}return{svg:function(){return u},data:function(){return t},slices:function(){return v}}}},{key:"slices",value:function(){return this.svg.selectAll(".jsc-slice")}},{key:"borderSlices",value:function(){return this.svg.selectAll(".jsc-slice-border")}},{key:"inactiveSlices",value:function(){return this.inactive(this.slices())}},{key:"inactiveBorderSlices",value:function(){return this.inactive(this.borderSlices())}},{key:"unhighlightSlices",value:function(){this.unhighligh(this.slices()),this.borderSlices().attr("opacity",0)}},{key:"unhighlightInactiveSlices",value:function(){this.unhighligh(this.inactiveSlices()),this.inactiveBorderSlices().attr("opacity",0)}},{key:"highlightSlice",value:function(e,t){switch(t){case a.ADD_BORDER:this.addBorderToSlice(e);break;case a.INCREASE_SIZE:this.increaseSliceSize(e)}}},{key:"addBorderToSlice",value:function(t){var n=e.select(t).attr("class");e.select(this.borderClassSelector(n)).attr("opacity",this.borderOpacity)}},{key:"increaseSliceSize",value:function(t){var n=e.svg.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius+this.increaseRadiusStep).padAngle(this.padAngle);e.select(t).transition().attr("d",n)}},{key:"unhighligh",value:function(t){var n=e.svg.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius).padAngle(this.padAngle);t.transition().attr("d",n)}},{key:"inactive",value:function(e){var t=this.findActiveSlice();return e.filter(function(e){return e.data.name!==t.data.name})}},{key:"borderClassSelector",value:function(e){var t=e.replace("jsc-slice","jsc-slice-border");return"."+(t=t.replace(/ /g,"."))}}]),t}()}});
