!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.JSCharts=e(t.d3)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,e,n){var i=void 0;return function(){var r=this,l=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(r,l)},e),a&&t.apply(r,l)}},n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,l=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,l=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw l}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;e.length>n;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=e;return{DonutBuilder:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t.target,this.fontSize=t.fontSize||38,this.lineHeight=t.lineHeight||20,this.colors=t.colors||null,this.fontColor=t.fontColor||"#000000",this.backgroundColor=t.backgroundColor||"#FFFFFF",this.width=t.size||300,this.height=t.size||300,this.highlightOnHover=t.highlightOnHover||!1,this.selectevent=t.selectevent||"mouseenter",this.selectblurevent=t.selectblurevent||"mouseleave",this.onselect=t.onselect||function(){},this.onselectblur=t.onselectblur||function(){},this.title=t.title,this.labels=t.labels,this.outerRadiusRatio=2.5,this.innerRadiusRatio=4,this.activeShadow=t.activeShadow||!1,this.padAngle=.01,this.withBorder=!1}return i(e,[{key:"onMouseEnterHandler",value:function(t){this.unhighlightInactiveSlices(),this.highlightSlice(t,this.hoverStrokeWidth,!1)}},{key:"onSelectHandler",value:function(t,e,n){this.selectSlice(n),this.unhighlightSlices(),this.highlightSlice(t,this.initialStrokeWidth),this.onselect.call(this.svg,this.findActiveSlice())}},{key:"onSelectBlurHandler",value:function(t,e,n){this.unhighlightInactiveSlices(),this.onselectblur.call(this.svg,this.findSlice(n))}},{key:"fontPx",value:function(t){if("number"!=typeof t)throw Error("Invalid fontSize value");return t+"px"}},{key:"midAngle",value:function(t){return t.startAngle+(t.endAngle-t.startAngle)/2}},{key:"selectSlice",value:function(t){this.slicestore.forEach(function(e){e.selected=e.index===t})}},{key:"findSlice",value:function(t){var e=null;return this.slicestore.forEach(function(n){n.index===t&&(e=n)}),e}},{key:"findActiveSlice",value:function(){var t=null;return this.slicestore.forEach(function(e){e.selected&&(t=e)}),t}},{key:"getColors",value:function(t){return t.map(function(t){return t.color})}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this;e=e.sort(function(t,e){return e.percent>t.percent});var l=i.colors?i.colors:i.getColors(e),a=t.layout.pie().value(function(t){return t.percent}).sort(null);i.outerRadius=i.width/i.outerRadiusRatio,i.innerRadius=i.width/i.innerRadiusRatio;var s=l?t.scale.ordinal().range(l):t.scale.category20(),c=t.svg.arc().outerRadius(i.outerRadius).innerRadius(i.innerRadius).padAngle(i.padAngle),o=t.select(i.target).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",-i.width/2+" "+-i.height/2+" "+i.width+" "+i.height).attr("preserveAspectRatio","xMinYMin").attr({class:"jsc-svg-container jsc-donut",style:"background-color: "+i.backgroundColor}).append("g"),u=o.selectAll("path").data(a(e)).enter().append("path").attr({d:c,fill:function(t,e){return s(t.data.name)}}),h=t.svg.arc().outerRadius(i.outerRadius+7).innerRadius(i.outerRadius+1).padAngle(i.padAngle),d=o.selectAll("path.outer-arc").data(a(e)).enter().append("path").attr({class:"outer-arc",d:h,fill:function(t,e){return s(t.data.name)},opacity:0}),f=o.selectAll(".legend").data(s.domain()).enter();i.title?f.append("text").attr("text-anchor","middle").attr("y",-1*i.lineHeight+30).attr("class",function(t,e){return"jsc-text jsc-text--title jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t){return i.title}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}):(f.append("text").attr("text-anchor","middle").attr("y",-1*i.lineHeight+10).attr("class",function(t,e){return"jsc-text jsc-text--name jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t){return t}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}),f.append("text").attr("text-anchor","middle").attr("y",i.lineHeight+10).attr("class",function(t,e){return"jsc-text jsc-text--percent jsc-text--"+e}).attr("visibility",function(t,e){return 0==e?"visible":"hidden"}).text(function(t,e){}).style({fill:i.fontColor,"font-size":i.fontPx(i.fontSize)}));var v=[];if(i.slicestore=v,i.svg=o,d.attr("class",function(t,e){return"u-clickable jsc-slice-border jsc-slice--"+e}),u.attr("class",function(t,n){return v.push({index:n,selected:0==n,data:e[n],fill:s(n)}),"u-clickable jsc-slice jsc-slice--"+n}).on("mouseenter",r(function(){i.highlightOnHover&&i.onMouseEnterHandler.call(i,this)},100)).on(i.selectevent,r(function(){i.onSelectHandler.apply(i,[this].concat(Array.prototype.slice.call(arguments)))},100)).on(i.selectblurevent,r(function(){i.onSelectBlurHandler.apply(i,[this].concat(Array.prototype.slice.call(arguments)))},100)),i.labels){var g=o.append("svg:g").attr("class","labels").selectAll("text").data(a(e),function(t){return t.data.name});g.enter().append("text").attr("class",function(t,e){return"jsc-label jsc-label--"+e}).attr("dy",".35em").text(function(t){return t.data.name}).on(i.selectevent,r(function(t,e){var r=o.select(".jsc-slice--"+e),l=n(r,1),a=n(l[0],1);i.onSelectHandler.call(i,a[0],t,e)},100)).on(i.selectblurevent,r(function(t,e){var r=o.select(".jsc-slice--"+e),l=n(r,1),a=n(l[0],1);i.onSelectBlurHandler.call(i,a[0],t,e)},100)),g.attr("transform",function(t){var e=c.centroid(t);return e[0]=innerRadius*(i.midAngle(t)<Math.PI?1:-1),"translate("+e+")"}).attr("text-anchor",function(t){return i.midAngle(t)<Math.PI?"start":"end"});var p=o.append("g").attr("class","lines").selectAll("polyline").data(a(e),function(t){return t.data.name});p.enter().append("polyline"),p.attr("points",function(t){var e=c.centroid(t);return e[0]=.95*innerRadius*(i.midAngle(t)<Math.PI?1:-1),[c.centroid(t),c.centroid(t),e]}).attr("class",function(t,e){return"jsc-label-line jsc-label-line--"+e}).attr("stroke-width","1").attr("fill","none").attr("stroke",function(t,e){return s(e)})}return{svg:function(){return o},data:function(){return e},slices:function(){return v}}}},{key:"slices",value:function(){return this.svg.selectAll(".jsc-slice")}},{key:"borderSlices",value:function(){return this.svg.selectAll(".jsc-slice-border")}},{key:"inactiveSlices",value:function(){return this.inactive(this.slices())}},{key:"inactiveBorderSlices",value:function(){return this.inactive(this.borderSlices())}},{key:"unhighlightSlices",value:function(){this.unhighligh(this.slices()),this.borderSlices().attr("opacity",0)}},{key:"unhighlightInactiveSlices",value:function(){this.unhighligh(this.inactiveSlices()),this.inactiveBorderSlices().attr("opacity",0)}},{key:"highlightSlice",value:function(e,n){if(this.withBorder){var i=t.select(e).attr("class");t.select(this.borderClassSelector(i)).attr("opacity",.4)}else{var r=t.svg.arc().innerRadius(this.innerRadius).outerRadius(1.08*this.outerRadius).padAngle(this.padAngle);t.select(e).transition().attr("d",r)}}},{key:"unhighligh",value:function(e){if(this.withBorder);else{var n=t.svg.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius).padAngle(this.padAngle);e.transition().attr("d",n)}}},{key:"inactive",value:function(t){var e=this.findActiveSlice();return t.filter(function(t){return t.data.name!==e.data.name})}},{key:"borderClassSelector",value:function(t){var e=t.replace("jsc-slice","jsc-slice-border");return"."+(e=e.replace(/ /g,"."))}}]),e}()}});
